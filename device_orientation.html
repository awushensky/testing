<html>
<head>
  <title>Testing device orientation</title>

  <style>
    .orientation-value {
      border: 1px solid black;
      width: 250px;
      height: 20px;
      margin-bottom: 10px;
    }

    .orientation-output {
      border: 1px solid black;
      width: 1024px;
      height: 1024px;
      margin-bottom: 10px;
    }

    .acceleration-value {
      border: 1px solid black;
      width: 150px;
      height: 20px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h1>Orientation</h1>
<div>
  <div>supported:</div>
  <div id="orientation_supported" class="orientation-value">...</div>
</div>

<div>
  <div>alpha:</div>
  <div id="orientation_alpha" class="orientation-value">&nbsp;</div>
</div>

<div>
  <div>beta:</div>
  <div id="orientation_beta" class="orientation-value">&nbsp;</div>
</div>

<div>
  <div>gamma:</div>
  <div id="orientation_gamma" class="orientation-value">&nbsp;</div>
</div>

<div>
  <div>output</div>
  <div id="orientation_output" class="orientation-output">&nbsp;</div>
</div>

<h1>Acceleration</h1>
<div>
  <div>supported:</div>
  <div id="motion_supported" class="acceleration-value">...</div>
</div>

<div>
  <div>accel:</div>
  <div id="acceleration_x" class="acceleration-value">&nbsp;</div>
  <div id="acceleration_y" class="acceleration-value">&nbsp;</div>
  <div id="acceleration_z" class="acceleration-value">&nbsp;</div>
</div>

<div>
  <div>accel with grav:</div>
  <div id="acceleration_grav_x" class="acceleration-value">&nbsp;</div>
  <div id="acceleration_grav_y" class="acceleration-value">&nbsp;</div>
  <div id="acceleration_grav_z" class="acceleration-value">&nbsp;</div>
</div>

<div>
  <div>rotation:</div>
  <div id="rotation_alpha" class="acceleration-value">&nbsp;</div>
  <div id="rotation_beta" class="acceleration-value">&nbsp;</div>
  <div id="rotation_gamma" class="acceleration-value">&nbsp;</div>
</div>

<div>
  <div>interval:</div>
  <div id="interval" class="acceleration-value">&nbsp;</div>
</div>

<script type="text/javascript">
  var metrics = [];

  if (window.DeviceOrientationEvent) {
    var lastOrientation = {
      'a':0,
      'b':0,
      'g':0,
      't':0
    };

    document.getElementById("orientation_supported").innerText = "true";
    window.addEventListener("deviceorientation", function(orientation) {
      var field_alpha = document.getElementById("orientation_alpha");
      var field_beta = document.getElementById("orientation_beta");
      var field_gamma = document.getElementById("orientation_gamma");
      var field_output = document.getElementById("orientation_output");

      var update = false;
      var time = new Date().getTime();

      if (Math.abs(orientation.alpha - lastOrientation.a) > 0) {
        lastOrientation.a = orientation.alpha;
        update = true;
      }

      if (Math.abs(orientation.beta - lastOrientation.b) > 0) {
        lastOrientation.b = orientation.beta;
        update = true;
      }

      if (Math.abs(orientation.gamma - lastOrientation.g) > 0) {
        lastOrientation.g = orientation.gamma;
        update = true;
      }

      if (Math.abs(time - lastOrientation.t) > 1000) {
        update = true;
      }

      if (update) {
        metrics.push({
          'a':orientation.alpha,
          'b':orientation.beta,
          'g':orientation.gamma,
          't':time
        });

        field_output.innerText = metrics.length;
      }

      field_alpha.innerText = orientation.alpha;
      field_beta.innerText = orientation.beta;
      field_gamma.innerText = orientation.gamma;
    });
  } else {
    document.getElementById("orientation_supported").innerText = "false";
  }

  if (window.DeviceMotionEvent) {
    var accel_threshold = 0.11;
    var rot_threshold = 0.05;

    var last_accel_x = 0;
    var last_accel_y = 0;
    var last_accel_z = 0;

    var last_accel_g_x = 0;
    var last_accel_g_y = 0;
    var last_accel_g_z = 0;

    var last_rot_alpha = 0;
    var last_rot_beta = 0;
    var last_rot_gamma = 0;

    document.getElementById("motion_supported").innerText = "true";
    window.addEventListener("devicemotion", function(eventData) {
      var field_accel_x = document.getElementById("acceleration_x");
      var field_accel_y = document.getElementById("acceleration_y");
      var field_accel_z = document.getElementById("acceleration_z");

      var field_rot_alpha = document.getElementById("rotation_alpha");
      var field_rot_beta = document.getElementById("rotation_beta");
      var field_rot_gamma = document.getElementById("rotation_gamma");

      var field_accel_g_x = document.getElementById("acceleration_grav_x");
      var field_accel_g_y = document.getElementById("acceleration_grav_y");
      var field_accel_g_z = document.getElementById("acceleration_grav_z");

      var field_interval = document.getElementById("interval");

      var accel = eventData.acceleration;
      var accel_g = eventData.accelerationIncludingGravity;
      var rot = eventData.rotationRate;
      var interval = eventData.interval;

      if (Math.abs(accel.x - last_accel_x) > accel_threshold) {
        last_accel_x = accel.x;
        field_accel_x.innerText = accel.x;
      }

      if (Math.abs(accel.y - last_accel_y) > accel_threshold) {
        last_accel_y = accel.y;
        field_accel_y.innerText = accel.y;
      }

      if (Math.abs(accel.z - last_accel_z) > accel_threshold) {
        last_accel_z = accel.z;
        field_accel_z.innerText = accel.z;
      }

      if (Math.abs(rot.alpha - last_rot_alpha) > rot_threshold) {
        last_rot_alpha = rot.alpha;
        field_rot_alpha.innerText = rot.alpha;
      }

      if (Math.abs(rot.beta - last_rot_beta) > rot_threshold) {
        last_rot_beta = rot.beta;
        field_rot_beta.innerText = rot.beta;
      }

      if (Math.abs(rot.gamma - last_rot_gamma) > rot_threshold) {
        last_rot_gamma = rot.gamma;
        field_rot_gamma.innerText = rot.gamma;
      }

      if (Math.abs(accel_g.x - last_accel_g_x) > accel_threshold) {
        last_accel_g_x = accel_g.x;
        field_accel_g_x.innerText = accel_g.x;
      }

      if (Math.abs(accel_g.y - last_accel_g_y) > accel_threshold) {
        last_accel_g_y = accel_g.y;
        field_accel_g_y.innerText = accel_g.y;
      }

      if (Math.abs(accel_g.z - last_accel_g_z) > accel_threshold) {
        last_accel_g_z = accel_g.z;
        field_accel_g_z.innerText = accel_g.z;
      }

      field_interval.innerText = interval;
    });
  } else {
    document.getElementById("motion_supported").innerText = "false";
  }
</script>

</body>
</html>